<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Meta setup -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Verztec</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
      /* Body setup for full viewport usage */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }
      
      body {
        padding-top: 110px; /* Space for fixed header */
        background-color: #f2f3fa;
        display: flex;
        flex-direction: column;
      }

      /* Chat section takes full remaining viewport */
      .chat-section {
        height: calc(100vh - 110px); /* Full viewport minus header */
        padding: 20px 15px 20px 15px; /* Consistent padding on all sides */
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      
      .chat-section .container-fluid {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: none; /* Remove Bootstrap's max-width constraint */
        padding: 0; /* Remove default container padding */
      }
      
      .chat-section .row {
        flex: 1;
        margin: 0; /* Remove row margins */
        height: 100%;
      }
      
      .chat-section .col-lg-6 {
        padding: 0 10px; /* Reduce column padding */
      }

      /* Avatar section */
      .chat-avatar {
        background: #e9ecef;
        border-radius: 8px;
        height: 100%;
        min-height: 400px; /* Minimum height for better appearance */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: #6c757d;
      }

      /* Chat panel fills available space */
      .chat-panel {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 400px; /* Minimum height for better appearance */
        overflow: hidden;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      
      .chat-header {
        background: #fff;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 1rem;
        flex-shrink: 0; /* Don't shrink the header */
      }
      
      .chat-body {
        flex: 1; /* Take up all available space */
        overflow-y: auto;
        background: #fafbfc;
        border-left: 1px solid #dee2e6;
        border-right: 1px solid #dee2e6;
        padding: 1rem;
        min-height: 250px; /* Ensure minimum scrollable area */
      }
      
      /* Message bubble styles */
      .chat-body .bot-initial {
        max-width: 80%;
        display: inline-block;
        background: #fff;
        border: 1px solid #ffc107;
        border-radius: 20px;
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        color: #333;
      }
      
      .chat-body .user-bubble {
        max-width: 80%;
        background: #ffc107;
        color: #333;
        border-radius: 20px;
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        margin-left: auto;
        display: block;
        text-align: left;
        word-wrap: break-word;
      }
      
      .chat-body .bot-bubble {
        max-width: 80%;
        display: block;
        background: #fff;
        border: 1px solid #ffc107;
        border-radius: 20px;
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        margin-right: auto;
        color: #333;
        word-wrap: break-word;
      }
      
      /* Chat input group */
      .chat-input-group {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: #fff;
        border: 1px solid #dee2e6;
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        flex-shrink: 0; /* Don't shrink the input area */
      }
      
      .chat-input-group input.form-control {
        border: 1px solid #dee2e6;
        box-shadow: none;
        border-radius: 24px;
        padding: 0.75rem 1rem;
        flex: 1;
      }
      
      .chat-input-group .btn-icon {
        border: none;
        background: transparent;
        font-size: 1.2rem;
        color: #333;
        margin-left: 0.5rem;
        padding: 0.5rem;
        border-radius: 50%;
        transition: background-color 0.2s;
      }
      
      .chat-input-group .btn-icon:hover {
        background-color: #f8f9fa;
      }
      
      .chat-input-group .btn-icon:focus {
        box-shadow: none;
        outline: none;
      }
    </style>
    </style>
</head>
<body>

  <!-- header (unchanged) -->
  <header class="header-area" style="position: fixed; top:0; left:0; width:100%; z-index:999; background:white;">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-xl-3 col-md-4 col-6">
          <a href="home.php" class="page-logo-wp"><img src="images/logo.png" alt=""></a>
        </div>
        <div class="col-xl-6 col-md-5 order-3 order-md-2 d-flex justify-content-center justify-content-md-start">
          <div class="page-menu-wp">
            <ul>
              <li><a href="home.php">Home</a></li>
              <li class="active"><a href="#">Chatbot</a></li>
              <li><a href="files.php">Files</a></li>
              <li><a href="admin/users.php">Admin</a></li>
            </ul>
          </div>
        </div>
        <div class="col-md-3 col-6 d-flex justify-content-end order-2 order-md-3">
          <div class="page-user-icon profile">
            <button><img src="images/Profile-Icon.svg" alt=""></button>
            <div class="menu">
              <ul>
                <li><a href="#"><i class="fa-regular fa-user"></i> Profile</a></li>
                <li><a href="#"><i class="fa-regular fa-message-smile"></i> Inbox</a></li>
                <li><a href="#"><i class="fa-regular fa-gear"></i> Settings</a></li>
                <li><a href="#"><i class="fa-regular fa-square-question"></i> Help</a></li>
                <li><a href="login.php"><i class="fa-regular fa-right-from-bracket"></i> Sign Out</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Chatbot Interface -->
  <section class="chat-section py-4">
    <div class="container-fluid">
      <div class="row">

        <!-- Left half for avatar -->
        <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="chat-avatar h-100">
            <div style="text-align: center;">
              <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ¤–</div>
              <h3 style="color: #495057; margin-bottom: 0.5rem;">VerzTec AI Assistant</h3>
              <p style="color: #6c757d; margin: 0;">Your intelligent workplace companion</p>
            </div>
          </div>
        </div>

        <!-- Right half for chat -->
        <div class="col-lg-6 d-flex">
          <div class="chat-panel w-100 shadow-sm rounded">

            <div class="chat-header">
              <h5 class="mb-0"><i class="fa fa-robot me-2"></i>VerzTec AI Assistant</h5>
            </div>

            <div id="chat-container" class="chat-body">
              <div class="bot-initial">
                <strong>VerzTec Assistant:</strong> Hello! I'm here to help you today. ðŸ˜Š
              </div>
            </div>

            <div class="chat-input-group">
              <input type="text"
                     id="user-input"
                     class="form-control"
                     placeholder="Ask anything..."
                     onkeypress="handleKeyPress(event)">
              <button class="btn-icon" type="button" onclick="sendMessage()">
                <i class="fa fa-paper-plane"></i>
              </button>
              <button class="btn-icon" type="button">
                <i class="fa fa-microphone"></i>
              </button>
              <button class="btn-icon" type="button">
                <i class="fa fa-plus"></i>
              </button>
            </div>

          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- All your existing scripts (unchanged) -->
  <script>
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }

    function sendMessage() {
      const userInput = document.getElementById('user-input');
      const message = userInput.value.trim();
      
      if (message === '') {
        return;
      }

      // Add user message to chat
      addMessageToChat(message, 'user');
      
      // Clear input and show loading
      userInput.value = '';
      showLoading();

      // Send message to chatbot API
      fetch('http://localhost:8000/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ question: message })
      })
      .then(response => response.json())
      .then(data => {
        hideLoading();
        addMessageToChat(data.answer, 'bot');
        
        // Add reference file link if available
        if (data.reference_file && data.reference_file.name) {
          addReferenceLink(data.reference_file.url, data.reference_file.name);
        }
      })
      .catch(error => {
        hideLoading();
        console.error('Error:', error);
        addMessageToChat('Sorry, I encountered an error. Please make sure the chatbot server is running on port 8000.', 'bot');
      });
    }

    function addMessageToChat(message, sender) {
      const chatContainer = document.getElementById('chat-container');
      const messageDiv = document.createElement('div');
      
      if (sender === 'user') {
        messageDiv.className = 'user-bubble';
        messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
      } else {
        messageDiv.className = 'bot-bubble';
        messageDiv.innerHTML = `<strong>VerzTec Assistant:</strong> ${message}`;
      }
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function addReferenceLink(url, filename) {
      const chatContainer = document.getElementById('chat-container');
      const linkDiv = document.createElement('div');
      
      linkDiv.className = 'bot-bubble';
      linkDiv.innerHTML = `
        <small><i class="fa fa-file-pdf"></i> Reference: <a href="${url}" target="_blank" style="color: #0066cc; text-decoration: underline;">${filename}</a></small>
      `;
      
      chatContainer.appendChild(linkDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showLoading() {
      const chatContainer = document.getElementById('chat-container');
      const loadingDiv = document.createElement('div');
      loadingDiv.id = 'loading-message';
      loadingDiv.className = 'bot-bubble';
      loadingDiv.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Thinking...';
      chatContainer.appendChild(loadingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideLoading() {
      const loadingMessage = document.getElementById('loading-message');
      if (loadingMessage) {
        loadingMessage.remove();
      }
    }
  </script>
  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/scripts.js"></script>
</body>
</html>
